<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Add this right after the other meta tags -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline'; img-src 'self' data:; connect-src 'self' wss:; font-src 'self' https://cdnjs.cloudflare.com;">
  <title>Pong.io - Menu</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS (after Bootstrap to override styles) -->
  <link rel="stylesheet" href="styles.css">
  <!-- Include Font Awesome for arrow icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  <div id="app" class="container-fluid p-0">
    <!-- Language Selection Page -->
    <div id="language-page" class="page active">
      <h2 class="text-center" data-i18n="selectLanguage">Select Language</h2>
      <select id="language-selector" class="button form-select mb-3">
        <option value="en">English</option>
        <option value="es">Español</option>
        <option value="fr">Français</option>
      </select>
      <button id="next-button" class="button btn btn-primary w-100" data-i18n="next">Next</button>    </div>

    <!-- Game Start Page (Nickname & Round Selection) -->
    <div id="game-page" class="page">
      <h2 id="enter-name" class="text-center" data-i18n="enterName">Enter Your Nickname</h2>
      <div class="mb-3">
        <input type="text" id="nickname" class="nickname-input form-control" placeholder="Enter a cool name">
      </div>
      <!-- Input for round amount -->
      <div class="mb-3">
        <input type="number" id="rounds-input" class="rounds-input form-control" placeholder="Enter rounds" value="3" min="1">
      </div>

      <!-- Join Game Button with two lines and arrow icons -->
      <div class="queue-wrapper d-flex align-items-center justify-content-center">
        <i id="prevMode" class="fa fa-caret-left" style="visibility: visible;"></i>
        <button id="start-game" class="button join-game-button btn btn-primary hidden">
          <div class="button-text" data-i18n="joinGame">JOIN GAME</div>
          <div class="game-mode-indicator">Classic with queue</div>
        </button>
        <i id="nextMode" class="fa fa-caret-right" style="visibility: visible;"></i>
      </div>

      <!-- Custom Game Page -->
      <div id="custom-game-page" class="page">
        <h2 class="text-center">Custom Game</h2>
        
        <!-- Code input section -->
        <div class="code-input-section mb-3">
          <label for="game-code" class="form-label">Game Code</label>
          <div class="input-group">
            <input type="text" id="game-code" class="form-control" placeholder="Enter special code...">
            <button id="apply-code" class="btn btn-primary">Apply</button>
          </div>
          <div class="d-flex justify-content-between mt-1">
            <button id="generate-code" class="btn btn-sm btn-info">Generate Code</button>
            <button id="copy-code" class="btn btn-sm btn-secondary">Copy to Clipboard</button>
          </div>
        </div>
        
        <!-- Presets -->
        <div class="preset-section mb-3">
          <label class="form-label">Quick Presets</label>
          <div class="d-flex flex-wrap gap-2 justify-content-center">
            <button class="preset-button btn btn-sm btn-outline-danger" data-preset="speedemon">Speedemon</button>
            <button class="preset-button btn btn-sm btn-outline-info" data-preset="retro">Retro</button>
            <button class="preset-button btn btn-sm btn-outline-warning" data-preset="giant">Giant Paddles</button>
            <button class="preset-button btn btn-sm btn-outline-success" data-preset="micro">Micro Mode</button>
            <button class="preset-button btn btn-sm btn-outline-primary" data-preset="chaos">Chaos</button>
          </div>
        </div>
        
        <!-- Customization Options -->
        <div class="customization-section">
          <!-- Ball Speed -->
          <div class="option-row mb-3">
            <label for="ball-speed" class="form-label">Ball Speed: <span id="ball-speed-value">4</span></label>
            <input type="range" class="form-range" id="ball-speed" min="2" max="10" step="0.5" value="4">
          </div>
          
          <!-- Paddle Size -->
          <div class="option-row mb-3">
            <label for="paddle-size" class="form-label">Paddle Size: <span id="paddle-size-value">100%</span></label>
            <input type="range" class="form-range" id="paddle-size" min="50" max="200" step="10" value="100">
          </div>
          
          <!-- Speed Increment -->
          <div class="option-row mb-3">
            <label for="speed-increment" class="form-label">Speed Increment: <span id="speed-increment-value">0.5</span></label>
            <input type="range" class="form-range" id="speed-increment" min="0" max="2" step="0.1" value="0.5">
          </div>
          
          <!-- Colors -->
          <div class="row mb-3">
            <div class="col">
              <label for="ball-color" class="form-label">Ball Color</label>
              <input type="color" class="form-control form-control-color" id="ball-color" value="#00d4ff">
            </div>
            <div class="col">
              <label for="left-paddle-color" class="form-label">Left Paddle</label>
              <input type="color" class="form-control form-control-color" id="left-paddle-color" value="#007bff">
            </div>
            <div class="col">
              <label for="right-paddle-color" class="form-label">Right Paddle</label>
              <input type="color" class="form-control form-control-color" id="right-paddle-color" value="#ff758c">
            </div>
          </div>
          
          <!-- Physics Options -->
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="gravity-enabled">
            <label class="form-check-label" for="gravity-enabled">
              Enable Gravity Effect
            </label>
          </div>
          
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="bounce-random">
            <label class="form-check-label" for="bounce-random">
              Random Bounce Angles
            </label>
          </div>
        </div>
        
        <!-- Start Game Button -->
        <button id="start-custom-game" class="button btn btn-primary w-100 mt-3">Start Custom Game</button>
        
        <!-- Back Button -->
        <button id="back-to-menu" data-navigate="game-page" class="button btn btn-secondary mt-2 w-100">Back to Menu</button>
      </div>

      <!-- Waiting Players Section -->
      <div id="waiting-players-container" class="card bg-transparent mt-3">
        <div class="card-body">
          <h3 class="card-title h5 mb-2">Currently Waiting Players <small class="text-muted">(click to join)</small></h3>
          <ul id="waiting-players-list" class="list-group list-group-flush bg-transparent"></ul>
        </div>
      </div>
      
      <button id="leaderboard-button" data-navigate="leaderboard-page" class="button btn btn-secondary secondary mt-3 w-100" data-i18n="leaderboard">Leaderboard</button>

    </div>

    <!-- Pong Game Page -->
    <div id="pong-page" class="page">
      <!-- Game Overlay for Fullscreen Info -->
      <div id="game-overlay" class="position-absolute">
        <div id="overlay-player-name" class="text-center"></div>
        <div id="overlay-score" class="text-center"></div>
      </div>
      
      <!-- Mini info display for when game is minimized -->
      <div id="game-info" class="game-info">
        <span id="player-name"></span> | Rounds: <span id="player-rounds">0</span> / <span id="target-rounds">0</span>
      </div>
      
      <canvas id="pong-canvas" class="w-100"></canvas>

      <div class="d-flex justify-content-between mt-3">
        <button id="end-game" class="button btn btn-secondary secondary hidden">Leave Game</button>
        <!-- Hidden debug button for testing -->
        <button id="debug-join" class="button btn btn-dark debug hidden">DEBUG JOIN</button>
      </div>
      <h3 id="pong-status" class="message text-center mt-3" data-i18n="waitingOpponent">Waiting for an opponent...</h3>
    </div>

    <!-- Leaderboard Page -->
    <div id="leaderboard-page" class="page">
      <h2 class="text-center" data-i18n="leaderboard">Leaderboard</h2>
      <div class="card bg-transparent mb-3">
        <div class="card-body p-0">
          <ul id="leaderboard" class="leaderboard-list list-group list-group-flush"></ul>
        </div>
      </div>
      <button id="back-button" data-navigate="game-page" class="button btn btn-secondary secondary w-100" data-i18n="back">Back</button>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Application JS Files -->
  <script src="js/utils.js"></script>
  <script src="js/localization.js"></script>
  <script src="js/ui-manager.js"></script>
  <script src="js/websocket.js"></script>
  <script src="js/pong-game.js"></script>
  <script src="js/background-pong.js"></script>
  <script src="js/main.js"></script>
  <script src="js/custom-game-manager.js"></script>
</body>
</html>